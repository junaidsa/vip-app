<!doctype html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Allied Tajar Retailor</title>
    <meta name="description" content="Finapp HTML Mobile Template">
    <meta name="keywords"
        content="bootstrap, wallet, banking, fintech mobile template, cordova, phonegap, mobile, html, responsive" />
    <link rel="icon" type="image/png" href="assets/img/favicon.png" sizes="32x32">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/img/icon/192x192.png">
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- <link rel="manifest" href="__manifest.json"> -->
</head>

<body>
    <style>
        #appCapsule {
            padding: 56px 0 0 0;

        }
    </style>

    <!-- loader -->
    <div id="loader">
        <img src="assets/img/loading-icon.png" alt="icon" class="loading-icon">
    </div>
    <!-- * loader -->

    <div class="appHeader bg-primary text-light">
        <div class="left">
            <a href="#" class="headerButton">
                <ion-icon name="chevron-back-outline" role="img" class="md hydrated"
                    aria-label="chevron back outline"></ion-icon>
            </a>
        </div>
        <div class="pageTitle">VIP CHIPS</div>
        <div class="right">
            <a href="#" class="headerButton" data-bs-toggle="modal" data-bs-target="#actionSheetForm">
                <ion-icon name="add-outline"></ion-icon>
            </a>
        </div>
    </div>

    <!-- App Capsule -->
    <div id="appCapsule">

        <!-- Wallet Card -->
        <div class="section wallet-card-section pt-1">
            <div class="wallet-card">
                <!-- Balance -->
                <div class="balance">
                    <div class="left">
                        <span class="title">Today Sale</span>
                        <h1 class="total" id="total-sales">Rs. 0.00</h1>
                    </div>
                    <div class="right">
                        <a href="#" class="button" data-bs-toggle="modal" data-bs-target="#PanelRight">
                            <ion-icon name="add-outline"></ion-icon>
                        </a>
                    </div>
                </div>
                <!-- * Balance -->
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-6">
                <div class="stat-box">
                    <div class="title">Paid Amount</div>
                    <div class="value" id="paid-amount">Rs. 0.00</div>
                </div>
            </div>
            <div class="col-6">
                <div class="stat-box">
                    <div class="title">Unpaid Amount</div>
                    <div class="value" id="unpaid-amount">Rs. 0.00</div>
                </div>
            </div>
        </div>
        <!-- Wallet Card -->

        <!-- Panel Right -->
        <div class="modal fade panelbox panelbox-right" id="PanelRight" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Create Order Panel</h5>
                        <a href="#" data-bs-dismiss="modal">Close</a>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-6 mb-2">
                                <div class="bill-box">
                                    <div class="img-wrapper">
                                        <img src="assets/img/logo.png" alt="img" class="image-block imaged w100">
                                    </div>
                                    <div class="price">RS 100</div>
                                    <p>VIP #1</p>
                                    <a href="#" class="btn btn-primary btn-block btn-sm add_order" data-item="VIP #1" data-price="100">ADD NOW</a>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="bill-box">
                                    <div class="img-wrapper">
                                        <img src="assets/img/logo.png" alt="img" class="image-block imaged w100">
                                    </div>
                                    <div class="price">RS 150</div>
                                    <p>VIP #2 </p>
                                    <a href="#" class="btn btn-primary btn-block btn-sm add_order" data-item="VIP #2" data-price="150">ADD NOW</a>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="bill-box">
                                    <div class="img-wrapper">
                                        <img src="assets/img/logo.png" alt="img" class="image-block imaged w100">
                                    </div>
                                    <div class="price">RS 200</div>
                                    <p>VIP #3 </p>
                                    <a href="#" class="btn btn-primary btn-block btn-sm add_order" data-item="VIP #3" data-price="200">ADD NOW</a>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="bill-box">
                                    <div class="img-wrapper">
                                        <img src="assets/img/logo.png" alt="img" class="image-block imaged w100">
                                    </div>
                                    <div class="price">RS 250</div>
                                    <p>VIP #4 </p>
                                    <a href="#" class="btn btn-primary btn-block btn-sm add_order" data-item="VIP #4" data-price="250">ADD NOW</a>
                                </div>
                            </div>
                        <div class="col-6 mb-2">
                            <div class="bill-box">
                                <div class="img-wrapper">
                                    <img src="assets/img/logo.png" alt="img" class="image-block imaged w100">
                                </div>
                                <div class="price">RS 300</div>
                                <p>VIP #5 </p>
                                <a href="#" class="btn btn-primary btn-block btn-sm add_order" data-item="VIP #5" data-price="300">ADD NOW</a>
                            </div>
                        </div>
                        <div class="col-6 mb-2">
                            <div class="bill-box">
                                <div class="img-wrapper">
                                    <img src="assets/img/logo.png" alt="img" class="image-block imaged w100">
                                </div>
                                <div class="price">RS 400</div>
                                <p>VIP #6 </p>
                                <a href="#" class="btn btn-primary btn-block btn-sm add_order" data-item="VIP #6" data-price="400">ADD NOW</a>
                            </div>
                        </div>
                        <div class="col-6 mb-2">
                            <div class="bill-box">
                                <div class="img-wrapper">
                                    <img src="assets/img/logo.png" alt="img" class="image-block imaged w100">
                                </div>
                                <div class="price">RS 500</div>
                                <p>VIP #7 </p>
                                <a href="#" class="btn btn-primary btn-block btn-sm add_order" data-item="VIP #7" data-price="500">ADD NOW</a>
                            </div>
                        </div>
                        <div class="col-6 mb-2">
                            <div class="bill-box">
                                <div class="img-wrapper">
                                    <img src="assets/img/logo.png" alt="img" class="image-block imaged w100">
                                </div>
                                <div class="price">RS 600</div>
                                <p>VIP #8 </p>
                                <a href="#" class="btn btn-primary btn-block btn-sm add_order" data-item="VIP #8" data-price="600">ADD NOW</a>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- * Panel Right -->
    </div>
    <!-- * Stats -->
    <div class="modal fade dialogbox" id="DialogBasic" data-bs-backdrop="static" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Confirm Order Payment</h5>
            </div>
            <div class="modal-body">
              Is the payment completed?
            </div>
            <div class="modal-footer">
              <div class="btn-inline">
                <button class="btn btn-text-secondary" data-bs-dismiss="modal" id="unpaidConfirmation">Unpaid</button>
                <button class="btn btn-text-primary" data-bs-dismiss="modal" id="paidConfirmation">Paid</button>
              </div>
            </div>
          </div>
        </div>
      </div>
        <!-- * Dialog Basic -->


    <!-- History -->
    <div class="section mt-4">
        <div class="section-heading">
            <h2 class="title">History</h2>
            <a href="#" class="link" onclick="deleteAllOrders()">Del All</a>
        </div>
        <div class="card">
            <ul  id="order-list" class="listview flush transparent no-line image-listview detailed-list mt-1 mb-1">
            </ul>
            <div class="card-body pt-0">
                <a href="#" class="btn btn-block btn-outline-secondary">Load more</a>
            </div>
        </div>
    </div>
    <!-- History -->
    <!-- Form Action Sheet -->
    <div class="modal fade action-sheet" id="actionSheetForm" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Custom Order</h5>
                </div>
                <div class="modal-body">
                    <div class="action-sheet-content">

                        <form>
                            <div class="form-group basic">
                                <label class="label">Enter Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text" id="basic-addon1">Rs
                                    </span>
                                    <input type="text" class="form-control" placeholder="0.00" value="">
                                </div>
                            </div>

                            <div class="form-group basic">
                                <button type="button" class="btn btn-primary btn-block btn-lg"
                                    data-bs-dismiss="modal">Create</button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- * Form Action Sheet -->
    <!-- app footer -->
    <div class="appFooter mt-2">
        <div class="footer-title">
            Copyright © Query Providers 2025. All Rights Reserved.
        </div>
    </div>
    <!-- * app footer -->

    </div>
    <!-- * App Capsule -->
    <!-- ========= JS Files =========  -->
    <!-- Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="assets/js/lib/bootstrap.bundle.min.js"></script>
    <!-- Ionicons -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <!-- Splide -->
    <script src="assets/js/plugins/splide/splide.min.js"></script>
    <!-- Base Js File -->
    <script src="assets/js/base.js"></script>


    <script>
    // ========= Custom Js File ========= 
let db;
let currentOrder = {};
let currentOrderId = null;

// Open IndexedDB
const request = indexedDB.open('OrderDB', 1);

request.onupgradeneeded = function (event) {
  db = event.target.result;
  const orderStore = db.createObjectStore('orders', { keyPath: 'id', autoIncrement: true });
  orderStore.createIndex('status', 'status', { unique: false });
};

request.onsuccess = function (event) {
  db = event.target.result;
  displayOrders();
};

request.onerror = function () {
  console.error('Database error');
};

document.querySelectorAll('.add_order').forEach(button => {
  button.addEventListener('click', function () {
    currentOrder.item = this.getAttribute('data-item');
    currentOrder.price = parseInt(this.getAttribute('data-price'));
    $('#DialogBasic').modal('show');
  });
});

document.getElementById('paidConfirmation').addEventListener('click', function () {
  addOrder('Paid');
});

document.getElementById('unpaidConfirmation').addEventListener('click', function () {
  addOrder('Unpaid');
});

function addOrder(status) {
  const order = {
    item: currentOrder.item,
    price: currentOrder.price,
    status: status
  };

  const transaction = db.transaction(['orders'], 'readwrite');
  const orderStore = transaction.objectStore('orders');
  orderStore.add(order);

  transaction.oncomplete = function () {
    displayOrders();
  };

  transaction.onerror = function () {
    console.error('Transaction failed');
  };
}

function displayOrders() {
    let totalSales = 0;
  let paidAmount = 0;
  let unpaidAmount = 0;
  const orderList = document.getElementById('order-list');
  const totalSalesElem = document.getElementById('total-sales');
  const paidAmountElem = document.getElementById('paid-amount');
  const unpaidAmountElem = document.getElementById('unpaid-amount');
  orderList.innerHTML = '';

  const transaction = db.transaction(['orders'], 'readonly');
  const orderStore = transaction.objectStore('orders');

  orderStore.openCursor().onsuccess = function (event) {
    const cursor = event.target.result;
    if (cursor) {
      const order = cursor.value;
      const listItem = document.createElement('li');
      listItem.className = "list-group-item d-flex justify-content-between align-items-center";
      listItem.innerHTML = `
        <a href="#" class="item">
          <div class="icon-box ${order.status === 'Paid' ? 'bg-success' : 'bg-danger'}">
            <ion-icon name="arrow-forward-outline"></ion-icon>
          </div>
          <div class="in">
            <div>
              <strong>${order.item}</strong>
              <div class="text-small text-secondary">Order ID: ${order.id}</div>
            </div>
            <div class="text-end">
              <strong>RS ${order.price}</strong>
              <div class="text-small">${order.status}</div>
            </div>
          </div>
        </a>
        <div>
          <button class="btn btn-success btn-sm mb-1 update-status ${order.status === 'Paid' ? 'd-none' : ' '}">Paid</button>
          <button class="btn btn-danger me-1 btn-sm delete-order">Delete</button>
        </div>
      `;
      totalSales += order.price;
      if (order.status === 'Paid') {
        paidAmount += order.price;
      } else {
        unpaidAmount += order.price;
      }

      // Delete Order Handler
      listItem.querySelector('.delete-order').addEventListener('click', function () {
        deleteOrder(order.id);
      });

      // Update Status Handler
      listItem.querySelector('.update-status').addEventListener('click', function () {
        updateOrderStatus(order.id, 'Paid');
      });

      orderList.appendChild(listItem);
      cursor.continue();
    }
    else {
      // Update the total amounts on the UI
      totalSalesElem.innerHTML = `RS ${totalSales}`;
      paidAmountElem.innerHTML = ` RS ${paidAmount}`;
      unpaidAmountElem.innerHTML = `RS ${unpaidAmount}`;
    }
  };
}

function deleteOrder(id) {
  const transaction = db.transaction(['orders'], 'readwrite');
  const orderStore = transaction.objectStore('orders');
  orderStore.delete(id);

  transaction.oncomplete = function () {
    displayOrders();
  };

  transaction.onerror = function () {
    console.error('Delete failed');
  };
}

function updateOrderStatus(id, status) {
  const transaction = db.transaction(['orders'], 'readwrite');
  const orderStore = transaction.objectStore('orders');

  const request = orderStore.get(id);
  request.onsuccess = function () {
    const order = request.result;
    order.status = status;
    orderStore.put(order);

    transaction.oncomplete = function () {
      displayOrders();
    };
  };
}
function deleteAllOrders() {
  // Ask for confirmation before deleting all orders
  if (confirm('Are you sure you want to delete?')) {
    const transaction = db.transaction(['orders'], 'readwrite');
    const orderStore = transaction.objectStore('orders');
    // Clear the object store to delete all orders
    const clearRequest = orderStore.clear();
    clearRequest.onsuccess = function() {
      displayOrders();
      alert('All orders have been deleted.');
    };

    clearRequest.onerror = function() {
      console.error('Failed to delete all orders');
    };
  } else {
    console.log('Deletion of orders was canceled.');
  }
}

    </script>

</body>

</html>